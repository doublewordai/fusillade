{
  "db_name": "PostgreSQL",
  "query": "\n            UPDATE requests\n            SET\n                state = 'superseded',\n                superseded_at = $2,\n                superseded_by_request_id = $1\n            WHERE\n                -- Find the racing pair: if winner is escalated, find original; if winner is original, find escalated\n                id = (\n                    SELECT CASE\n                        WHEN w.is_escalated THEN w.escalated_from_request_id\n                        ELSE e.id\n                    END\n                    FROM requests w\n                    LEFT JOIN requests e ON e.escalated_from_request_id = w.id AND e.is_escalated = true\n                    WHERE w.id = $1\n                )\n                -- Only supersede if not already in a terminal state\n                AND state NOT IN ('completed', 'failed', 'canceled', 'superseded')\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Uuid",
        "Timestamptz"
      ]
    },
    "nullable": []
  },
  "hash": "1aba2cb3a7675f70a18ba90694135efb23f29835f5a19857e0460dc7cebd18f7"
}
